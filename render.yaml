# üìç Caminho: modelfleuriet/render.yaml
# Vers√£o final corrigida para o seu Blueprint

# Define o nome do banco de dados uma vez para evitar repeti√ß√£o e erros
# IMPORTANTE: Verifique se 'modelfleuriet-db' √© o nome exato do seu banco no Render
x-database-name: &db_name modelfleuriet-db

services:
  # -------------------------------------------------------------------
  # SERVI√áO 1: Job para Preparar o Banco de Dados (Passo Essencial que Faltava)
  # -------------------------------------------------------------------
  # Finalidade: Executar o script 'preprocess_to_db_light.py' para carregar
  #             os dados financeiros no seu banco de dados vazio.
  # -------------------------------------------------------------------
  - type: job
    name: db-setup
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python preprocess_to_db_light.py"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.13
      - key: DATABASE_URL
        fromDatabase:
          name: *db_name
          property: connectionString

  # -------------------------------------------------------------------
  # SERVI√áO 2: Sua Aplica√ß√£o Web Principal (o Site)
  # -------------------------------------------------------------------
  - type: web
    name: modelfleuriet
    region: oregon
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn flask_app:app"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.13
      - key: SECRET_KEY
        generateValue: true # Mais seguro: o Render gera a chave para voc√™
      - key: DATABASE_URL
        fromDatabase:
          name: *db_name
          property: connectionString # Mais seguro e eficiente: usa a conex√£o interna

  # -------------------------------------------------------------------
  # SERVI√áO 3: Job para Atualizar o Valuation (Vers√£o Gratuita)
  # -------------------------------------------------------------------
  # Finalidade: Rodar 'run_valuation_worker.py' para recalcular os valuations.
  #             Substitu√≠mos 'cron' (pago) por 'job' (gratuito).
  # -------------------------------------------------------------------
  - type: job
    name: valuation-worker
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python run_valuation_worker.py"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.13
      - key: DATABASE_URL
        fromDatabase:
          name: *db_name
          property: connectionString
